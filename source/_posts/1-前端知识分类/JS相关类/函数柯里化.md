# å‡½æ•°æŸ¯é‡ŒåŒ–

> æŸ¯é‡ŒåŒ–ï¼Œä¹Ÿå¸¸è¯‘ä¸ºâ€œå±€éƒ¨å¥—ç”¨â€ï¼Œæ˜¯æŠŠå¤šå‚æ•°å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—å•å‚æ•°å‡½æ•°å¹¶è¿›è¡Œè°ƒç”¨çš„æŠ€æœ¯ã€‚è¿™é¡¹æŠ€æœ¯ä»¥ç§‘å­¦å®¶Haskell Curryçš„åå­—å‘½åã€‚
>    ã€Šjavascriptè¯­è¨€ç²¾ç²¹ã€‹

> curry æ–¹æ³•é€šè¿‡åˆ›å»ºä¸€ä¸ªä¿å­˜ç€åŸå§‹å‡½æ•°å’Œè¦è¢«è°ƒç”¨çš„å‚æ•°çš„é—­åŒ…æ¥å·¥ä½œï¼Œä»–è¿”å›å¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¼šè¿”å›è°ƒç”¨åŸå§‹å‡½æ•°çš„ç»“æœï¼Œå¹¶ä¼ é€’è°ƒç”¨curryæ—¶çš„å‚æ•°åŠ ä¸Šå½“å‰è°ƒç”¨æ—¶çš„å‚æ•°



## åº”ç”¨åœºæ™¯

å¦‚æœä¸€ä¸ªå•†åº—æ¯å¤©æŠ˜æ‰£ä¸åŒï¼Œé‚£ä¹ˆé€šå¸¸å†™ä¸€ä¸ªå‡½æ•°æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯è¿™æ ·æ¯æ¬¡éƒ½è¦è¾“å…¥æŠ˜æ‰£å’Œä»·æ ¼

```javascript
function discount(dis, price) {
  return dis * 0.01 * price;
}


discount(2, 200)
discount(4, 200)
```

- æŸ¯é‡ŒåŒ–çš„å†™æ³•, åªéœ€è¦è¾“å…¥ä¸€æ¬¡æŠ˜æ‰£ï¼Œä¹‹åæ¯æ¬¡åªéœ€è¦è¾“å…¥ä»·æ ¼å°±å¯ä»¥äº†

```javascript
function discount2(dis) {
  return function(price) {
    return dis * 0.1 * price;
  };
}
// äº”æŠ˜
const fiveDiscount = discount2(5);
// å››æŠ˜
const fourDiscount = discount2(4);

fiveDiscount(300)   // 150
fourDiscount(300)  // 120

```





## å†™æ³•1: åŸºç¡€å®ç°

**å‡½æ•°æŸ¯é‡ŒåŒ–** å®ƒç”¨äºåˆ›å»ºå·²ç»è®¾ç½®å¥½äº†ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°ã€‚
å‡½æ•°æŸ¯é‡ŒåŒ–çš„åŸºæœ¬æ–¹æ³•å’Œå‡½æ•°ç»‘å®šæ˜¯ä¸€æ ·çš„ï¼šä½¿ç”¨ä¸€ä¸ªé—­åŒ…è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œå½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¿”å›çš„å‡½æ•°è¿˜éœ€è¦è®¾ç½®ä¸€äº›ä¼ å…¥çš„å‚æ•°ï¼ˆå¦‚ä¸Šé¢æŠ˜æ‰£çš„ä¾‹å­ï¼ŒfiveDiscount()è°ƒç”¨æ—¶è¿˜éœ€è¦å‚æ•°priceï¼‰

å‡½æ•°æŸ¯é‡ŒåŒ–é€šå¸¸ä¸ä»¥ä¸‹æ­¥éª¤åŠ¨æ€ **åˆ›å»º**ï¼šè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°å¹¶ä¸ºä»–ä¼ å…¥è¦`æŸ¯é‡ŒåŒ–çš„å‡½æ•°`å’Œ`å¿…è¦å‚æ•°`


```javascript
/* è¯¥ä¾‹æ¥è‡ªã€Šjavascripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ */
/**
 * @des : å‡½æ•°æŸ¯é‡ŒåŒ–
 * @param {Function} [fn] è¦è¿›è¡ŒæŸ¯é‡ŒåŒ–çš„å‡½æ•°
 * @param {*} å…¶ä»–å‚æ•°
 * @return {*} å°†å‚æ•°é€šè¿‡å‡½æ•°fnå¤„ç†ä¹‹åçš„ç»“æœ
 */
function curry(fn) {
  // curry ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¿›è¡ŒæŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼Œå…¶ä»–å‚æ•°æ˜¯è¦ä¼ å…¥çš„å€¼
  // è·å–ç¬¬ä¸€ä¸ªå‚æ•°å¤–çš„å…¶ä»–å‚æ•°
  var args = Array.prototype.slice.call(arguments, 1); // args,åŒ…å«äº†æ¥è‡ªå¤–éƒ¨å‡½æ•°
  return function() {
    var innerArgs = Array.prototype.slice.call(arguments); // innerArgsï¼Œç”¨æ¥å­˜æ”¾å†…éƒ¨å‡½æ•°çš„æ‰€æœ‰å‚æ•°
    var finalArgs = args.concat(innerArgs); // finalArgsï¼Œå†…éƒ¨å¤–éƒ¨æ‰€æœ‰çš„å‚æ•°
    return fn.apply(null, finalArgs); // ä½¿ç”¨applyå°†ç»“æœä¼ é€’ç»™å‡½æ•° fn
  };
}

function add(num1, num2) {
  return num1 + num2;
}
const curriedAdd = curry(add, 5);
curriedAdd(3);  // 8

```


ä¹Ÿå¯ä»¥åƒè¿™æ ·ä¸€æ¬¡æ€§ç»™å‡ºæ‰€æœ‰å‚æ•°

```javascript
const curriedAdd2 = curry(add, 5, 3);
curriedAdd();  // 8

```




## å†™æ³•2: ES6ç®€åŒ–ç‰ˆæœ¬

ç»“åˆES6è¯­æ³•å°†`curry()`ç»“æ„è¿›è¡Œç®€åŒ–
ç”±äºç®­å¤´å‡½æ•°æ²¡æœ‰ç»‘å®šargumens, æ‰€ä»¥å¦‚æœåœ¨ç®­å¤´å‡½æ•°å†…éƒ¨è®¿é—®`arguments`å¯¹è±¡ï¼Œä»–ä¼šå‘ä¸ŠæŸ¥æ‰¾, ç»‘å®šè·ç¦»æœ€è¿‘çš„éç®­å¤´å‡½æ•°çš„argumentså¯¹è±¡



```javascript
/**
 * @des æŸ¯é‡ŒåŒ–å‡½æ•°ç®­å¤´å‡½æ•°ç‰ˆæœ¬
 * @param {Function} fn å¸Œæœ›å¯ä»¥æŸ¯é‡ŒåŒ–çš„å‡½æ•°
 * @param {*} [å‚æ•°ä»¬]
 * @return {Function} æŸ¯é‡ŒåŒ–ä¹‹åçš„å‡½æ•°
 */
function curry(fn, ...args) {
  return (..._args) => fn(...args, ..._args);
}

```




## å†™æ³•3: å¥å£®ç‰ˆ


ğŸBUT ,ä»¥ä¸Šå†™æ³•å­˜åœ¨é—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½ä¼ é€’ä¸¤æ¬¡å‚æ•°ï¼Œè¦ä¹ˆç¬¬ä¸€æ¬¡ç»™ä¸€éƒ¨åˆ†ï¼Œç¬¬äºŒæ¬¡ç»™ä¸€éƒ¨åˆ†ï¼Œè¦ä¹ˆä¸€æ¬¡æ€§ç»™å‡ºæ‰€æœ‰å‚æ•°ï¼Œç„¶ååœ¨è°ƒç”¨å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸ç¡®å®šæ¯æ¬¡ä¼ é€’å‚æ•°çš„ **ä¸ªæ•°** å’Œ **æ¬¡æ•°**ï¼Œåˆ™ä»¥ä¸Šå†™æ³•åˆ™ä¸å¯è¡Œï¼š

å¦‚æœä¼ å…¥çš„fnæ˜¯


```javascript
const add = function(val1, val2, val3, val4, val5) {
  return val1 + val2 + val3 + val4 + val5;
};
```


```js
/* âœ…ä»…è¯¥ç§æƒ…å†µä¸‹å¯è¡Œï¼Œå³ä¸€æ¬¡æ€§ä¼ å…¥æ‰€æœ‰å‚æ•° */
curry(add, 1, 2, 3, 4, 5)(); // 15

/* âœ…ä»…è¯¥ç§æƒ…å†µä¸‹å¯è¡Œï¼Œå³åˆ†ä¸¤æ¬¡ä¼ å…¥æ‰€æœ‰å‚æ•° */
let res = curry(add, 1)(2, 3, 4, 5); // 15


/* âŒè°ƒç”¨æ¬¡æ•°å¤§äºä¸¤æ¬¡åˆ™ä¸å¯è¡Œ */
curry(add, 1)(2, 3)(4)(5) // curry(...)(...) is not a function
curry(add, 1)(2)(3)(4)(5) // curry(...)(...) is not a function
```

 
ä¸ºäº†ä½¿curryæ›´åŠ å¥å£®ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ç”¨äºæ˜¯å¦å·²ç»è¾“å…¥äº†æ‰€æœ‰çš„å‚æ•°ï¼ˆfn.lengthï¼‰ï¼Œ
è‹¥å‚æ•°è¿˜æœªè¾“å…¥å®Œæ¯•ï¼Œåˆ™è¿”å›ä¸€ä¸ªå‡½æ•°ä½¿ç”¨æˆ·å¯ä»¥ç»§ç»­è¾“å…¥ï¼›
è‹¥å·²ç»è¾“å…¥å®Œæ¯•ï¼Œåˆ™è¿”å›å‚æ•°æ ¹æ®å‡½æ•°`fn`çš„è§„åˆ™è®¡ç®—çš„ç»“æœï¼Œä»£ç å¦‚ä¸‹


```javascript

function add(a, b, c, d, e) {
  return a + b + c + d + e;
}

function curry(fn, ...args) {
  const length = fn.length;

  return function(..._args) {
    const finalArgs = [...args, ..._args];

    if (finalArgs.length < length) {
      return curry.call(this, fn, ...finalArgs);
    } else {
      return fn.apply(this, finalArgs);
    }
  };
}

```

è°ƒç”¨ä¸€ä¸‹è¯•è¯•çœ‹,  éƒ½å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœ

```javascript
console.log(curry(add, 1)(2, 3)(4)(5)); // 15
console.log(curry(add)(1, 2, 3, 4, 5)); // 15
console.log(curry(add)(1, 2)(3, 4, 5)); // 15
```


## å†™æ³•4: å°æç®€åŒ–ç‰ˆæœ¬


```js
const add = function(val1, val2, val3, val4, val5) {
  return val1 + val2 + val3 + val4 + val5;
};

function curry(fn, ...args) {
  if (fn.length > args.length) {
    return (...innerArgs) => curry.call(this, fn, ...args, ...innerArgs);
  } else {
    return fn.apply(this, args);
  }
}

let res = curry(add, 1)(2, 3)(4)(5);
console.log(res); // 15
```




## åº”ç”¨

å®é™…å¼€å‘é‡çš„åº”ç”¨åœºæ™¯


vueæºç ä¸­çš„`patch`å‡½æ•°(`_update`çš„æ ¸å¿ƒ)

ä¸åŒå¹³å°çš„`patch`æ–¹æ³•çš„ä¸»è¦é€»è¾‘æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†å…¬å…±çš„éƒ¨åˆ†å°±æ‰˜ç®¡åœ¨coreè¿™ä¸ªå¤§çš„ç›®å½•ä¸‹ï¼Œå·®å¼‚åŒ–éƒ¨åˆ†åªéœ€è¦é€šè¿‡å‚æ•°æ¥åŒºåˆ«ï¼Œ
è¿™é‡Œä½¿ç”¨å‡½æ•°æŸ¯é‡ŒåŒ–çš„æŠ€å·§ï¼Œé€šè¿‡ `createPatchFUnction` æŠŠå·®å¼‚åŒ–å‚æ•°æå‰å›ºåŒ–ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡è°ƒç”¨patchçš„æ—¶å€™éƒ½ä¼ é€’ `nodeOps` å’Œ `modules`ï¼ˆçœå»äº†æ¯æ¬¡ä½¿ç”¨éƒ½å»åˆ¤æ–­å½“å‰å¹³å°ï¼Œç„¶åå†åšæ“ä½œï¼‰






# æˆ‘çš„ç–‘é—®ï¼Ÿ

æ­£å¸¸æ¥æƒ³ï¼Œ3 * 0.1 * 300 = 90ï¼Œä½†æ˜¯ç»“æœå¹¶ä¸æ˜¯ï¼Ÿï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ


```javascript
// ä¸ºä»€ä¹ˆä¸æ˜¯ 90
function discount2(dis) {
  return function(price) {
    return dis * 0.1 * price;
  };
}
// äº”æŠ˜
const threeDiscount = discount2(3);
threeDiscount(300);  // 90.00000000000001

```


## å‚è€ƒæ–‡ç« 

1. [ã€Šjavascriptè¯­è¨€ç²¾ç²¹ã€‹(ç¬¬å››ç« -å‡½æ•°)]
2. [ã€Šjavascripté«˜çº§ç¨‹åºè®¾è®¡-é«˜çº§æŠ€å·§ã€‹(ç¬¬22ç« -é«˜çº§æŠ€å·§)]
3. [ç®­å¤´å‡½æ•°MDN]
4. [ã€Œè¯‘ã€ç†è§£JavaScriptçš„æŸ¯é‡ŒåŒ–](https://juejin.im/post/5bf18715e51d45244939acc5)
5. [å†´ç¾½ES6å‡½æ•°æŸ¯é‡ŒåŒ–](https://github.com/mqyqingfeng/Blog/issues/42)